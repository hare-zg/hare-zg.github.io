---
layout: post
title: Nas 组装过程
date: 2021-03-13
categories: diy
tags: nas 
---


[TOC]

### U盘的准备

1. 登录官方网站`https://www.openmediavault.org/`下载最新稳定版本
2. 登录`etcher`项目官网`https://www.balena.io/etcher`下载安装`etcher`
3. 通过`etcher`制作U盘系统安装盘

### omv(openmediavault)系统的安装

通过U盘启动主机

1. `Select a language`: 选择第一个`C - No localiztion`
2. `Select your location`: 选择`Asia`->`China`
3. `Configure the keyboard`: 选择`Chinese`
4. `Configure the networ`: 如果有多个网口会弹出这个设置，选择接入网线的网口
5. `Configure the network`: 设置主机名输入`omv`->设置域名`local`
6. `Set up users and passwords`: 设置root密码，这里直接按回车跳过密码设置，确认密码页面再次按回车跳过，这样就禁用了root账户。接下来提示创建管理系统的普通账户，先输入全名`Hare`->用户名`hare`->密码`ganggang1314`->确认密码`ganggang1314`
7. `partition disks`: 由于有多个存储设备，系统安全提示，这里确认继续。选择系统安装的存储盘。系统自动分区，确认进入下一步
8. `Install the system`: 系统自动安装
9. `Configure the package manager`: 包管理器使用的源设置，`China`->选择合适的镜像源`mirrors.163.com`，接下来系统提示设置代理，直接回车跳过不使用
10. `Configuring apt`: 系统安装
11. `Configuring resolvconf`: 系统安装完成提示拔出U盘重启电脑，这里不拔出U盘
12. 登录后输入命令`sudo update-grub`
13. 拔掉U盘重启系统
14. 接下来就可以通过`http://omv.local`来访问`omv`页面了, 或者通过`ip`访问(可以通过`fing`手机应用来查找`ip`)
15. 管理账号: `admin`, 密码: `openmediavault`

### 全面改用国内软件源

#### 1. 编辑`sources.list`

   ```shell
   # 备份配置文件
   sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
   # 清空配置文件
   sudo sh -c 'echo > /etc/apt/sources.list'
   # 编辑配置文件
   sudo nano /etc/apt/sources.list
   ```

   复制并粘贴以下内容：

   ```
   deb http://mirrors.tuna.tsinghua.edu.cn/debian/ buster main
   # deb-src http://mirrors.tuna.tsinghua.edu.cn/debian/ buster main
   
   deb http://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free
   # deb-src http://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free
   
   deb http://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free
   # deb-src http://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free
   ```

#### 2. 编辑 openmediavault-kernel-backports.list

```shell
# 备份配置文件
sudo cp /etc/apt/sources.list.d/openmediavault-kernel-backports.list /etc/apt/sources.list.d/openmediavault-kernel-backports.list.bak
# 清空配置文件
sudo sh -c 'echo > /etc/apt/sources.list.d/openmediavault-kernel-backports.list'
# 编辑配置文件
sudo nano /etc/apt/sources.list.d/openmediavault-kernel-backports.list
```

复制并粘贴以下内容：

```
deb https://mirrors.tuna.tsinghua.edu.cn/debian buster-backports main contrib non-free
```

#### 3. 编辑 openmediavault.list

```shell
# 备份配置文件
sudo cp /etc/apt/sources.list.d/openmediavault.list /etc/apt/sources.list.d/openmediavault.list.bak
# 清空配置文件
sudo sh -c 'echo > /etc/apt/sources.list.d/openmediavault.list'
# 编辑配置文件
sudo nano /etc/apt/sources.list.d/openmediavault.list
```

复制并粘贴以下内容：

```
deb https://mirrors.tuna.tsinghua.edu.cn/OpenMediaVault/public/ usul main
```

#### 4. 编辑 omvextras.list

```shell
# 备份配置文件
sudo cp /etc/apt/sources.list.d/omvextras.list /etc/apt/sources.list.d/omvextras.list.bak
# 清空配置文件
sudo sh -c 'echo > /etc/apt/sources.list.d/omvextras.list'
# 编辑配置文件
sudo nano /etc/apt/sources.list.d/omvextras.list
```

复制并粘贴以下内容：

```
deb https://mirrors.tuna.tsinghua.edu.cn/OpenMediaVault/openmediavault-plugin-developers/usul buster main
deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian buster stable
deb http://linux.teamviewer.com/deb stable main
```

